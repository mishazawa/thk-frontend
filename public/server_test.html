<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>THK Text Server Demo</title>
</head>
<body>
  <input id="textInput" type="text" placeholder="Enter text…" />
  <button id="sendButton">Send JSON</button>
  <pre id="status"></pre>

  <script>
    const sendButton = document.getElementById("sendButton");
    const textInput = document.getElementById("textInput");
    const statusEl = document.getElementById("status");

    const config = {
      server: "https://1cb16ef97e6a.ngrok-free.app/", // note the trailing slash '/'!!!
      // server: "http://localhost:6969/", // note the trailing slash
    };

    function setStatus(msg) {
      console.log(msg);
      statusEl.textContent = typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2);
    }

    sendButton.addEventListener("click", async () => {
      setStatus("Clicked. Sending…");
      sendButton.disabled = true;

      const thk_params = {
        text: textInput.value || "Hello, World!",
        style: [0.9, 0.05, 0.025, 0.025],
        dynamics: 1443.543,
      };

      try {
        const res = await fetch(config.server, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(thk_params),
        });

        const text = await res.text();
        setStatus({ httpStatus: res.status, bodyText: text });

        let data = null;
        try { data = JSON.parse(text); } catch {}
        if (data) {
          const time = data.time * 1000;
          const length = data.length * 1000;
          // sync();
        }
      } catch (err) {
        setStatus(`Fetch error: ${err}`);
      } finally {
        sendButton.disabled = false;
      }
    });
  </script>
</body>
</html>